# Vue.js+Socket.io+Koa2æ‰“é€ ä¸€ä¸ªæ™ºèƒ½èŠå¤©å®¤Vue.jså…¨å®¶æ¡¶+Socket.io+Express/Koa2 æ‰“é€ çš„ä¸€ä¸ªæ™ºèƒ½èŠå¤©å®¤ã€‚å·²ç»å¼€æºå•¦ï¼ä¸ºäº†æ–¹ä¾¿å¤§å®¶å­¦ä¹ ï¼Œæ™ºèƒ½æœºå™¨äººã€IPå®šä½æ¥å£ä¹Ÿå¼€æ”¾äº†ï¼æ¥å£è¯·åœ¨æºç ä¸­æŸ¥çœ‹ğŸ˜„> &nbsp;&nbsp;&nbsp;QQç¾¤é‡Œé¢çš„æ™ºèƒ½æœºå™¨äººå¾ˆç«ï¼Œäºæ˜¯ç”¨Vue.js+Socket.io+Koa2æ‰“é€ äº†ä¸€ä¸ªæ™ºèƒ½èŠå¤©å®¤ï¼Œå®ç°äº†IPå®šä½ã€åœ¨çº¿ç¾¤èŠï¼ŒåŠ å…¥äº†Emojiè¡¨æƒ…ğŸ˜„ï¼Œä»¥åŠæ¥å…¥äº†æ™ºèƒ½æœºå™¨äººğŸ˜## å‰è¨€è¯è¯´æœ€è¿‘å‰ç«¯æŠ€æœ¯åœˆä¹Ÿæœ‰æ´¾ç³»ä¹‹äº‰äº†ï¼Œæ˜¯å¥½äº‹è¿˜æ˜¯åäº‹ï¼Ÿèåœé’èœå„æœ‰æ‰€çˆ±ï¼Œæœ¬é¡¹ç›®é‡‡ç”¨çš„æ˜¯Vue.jsåšå‰ç«¯é¡µé¢å±•ç¤ºï¼Œå¤§å®¶å®Œå…¨å¯ä»¥æ¢æˆè‡ªå·±åˆ«çš„å–œæ¬¢çš„ï¼ŒReactã€Angularç­‰ç­‰ï¼Œæ¯ä¸ªæ¡†æ¶éƒ½æœ‰å¯å–çš„åœ°æ–¹ï¼Œè¿™é‡Œä¸å¤šè¯´ğŸ˜‚ä¸‹é¢æ‰¯åˆ°æ­£é¢˜ä¸ŠğŸ‘‡## é¢„è§ˆåœ¨çº¿é¢„è§ˆåœ°å€ï¼šğŸ‘‰ https://microzz.com/vue-chat/![Vue.js+Socket.io æ™ºèƒ½èŠå¤©å®¤ microzz.com](https://dn-mhke0kuv.qbox.me/24330ba3e01436df1eb8.png)![Vue.js+Socket.io æ™ºèƒ½èŠå¤©å®¤ microzz.com](https://dn-mhke0kuv.qbox.me/a5abbff92a442fa2d356.png)## æºä»£ç  ç°åœ¨å·²ç»å¼€æºï¼š ğŸ‘‰https://github.com/microzz/vue-chat æ¬¢è¿starå’Œæå‡ºå®è´µæ„è§ğŸ˜„## æŠ€æœ¯æ ˆ* **Vue2.0**ï¼šå‰ç«¯é¡µé¢å±•ç¤ºã€‚* **Socket.io**ï¼šå®ç°å®æ—¶é€šä¿¡* **Vuex**ï¼šVuexï¼Œå®ç°ä¸åŒç»„ä»¶é—´çš„çŠ¶æ€å…±äº«* **vue-router**ï¼šé¡µé¢è·¯ç”±åˆ‡æ¢* **axios**ï¼šä¸€ä¸ªåŸºäº `Promise` çš„ HTTP åº“ï¼Œå‘åç«¯å‘èµ·è¯·æ±‚ã€‚* **Express**ã€**Koa2**ï¼šå› ä¸ºvue-cliç”Ÿæˆçš„é¡¹ç›®æ˜¯åŸºäº**express**çš„ï¼Œæ‰€ä»¥åœ¨å¼€å‘é˜¶æ®µæˆ‘ä½¿ç”¨çš„æ˜¯å®ƒï¼Œä½†æ˜¯çœŸæ­£ä¸Šçº¿ç”Ÿäº§ç¯å¢ƒæˆ‘æ¢æˆäº†**Koa2**ã€‚* **Moment.js**ï¼šä¸€ä¸ªæ—¶é—´å¤„ç†çš„åº“ï¼Œæ–¹ä¾¿å¯¹æ—¶é—´è¿›è¡Œæ ¼å¼åŒ–æˆéœ€è¦çš„æ ¼å¼ã€‚* **ES6**ã€**ES7**ï¼šé‡‡ç”¨ES6è¯­æ³•ï¼Œè¿™æ˜¯ä»¥åçš„è¶‹åŠ¿ã€‚ç®­å¤´å‡½æ•°ã€Promiseç­‰ç­‰è¯­æ³•å¾ˆå¥½ç”¨ã€‚* **localStorage**ï¼šä¿å­˜ç”¨æˆ·ä¿¡æ¯ä»¥åŠèŠå¤©è®°å½•ã€‚* **Webpack**ï¼švue-cliè‡ªå¸¦Webpackï¼Œä½†æ˜¯éœ€è¦è‡ªå·±æ”¹é€ ä¸€ä¸‹ï¼Œæ¯”å¦‚è¦å¯¹éœ€è¦å®‰è£…sassç›¸å…³loaderï¼Œvue-cliå·²ç»é…ç½®å¥½äº†webpackï¼Œä½ åªéœ€è¦å®‰è£…ä¾èµ–å°±å¯ä»¥ï¼Œä½¿ç”¨çš„æ—¶å€™åªéœ€è¦`<style lang="scss"></style>`ã€‚* **SASS**(**SCSS**)ï¼šç”¨SCSSåšCSSé¢„å¤„ç†è¯­è¨€ï¼Œæœ‰äº›åœ°æ–¹å¾ˆæ–¹ä¾¿ï¼Œä¸ªäººå¾ˆå–œæ¬¢ç”¨ã€‚(è¯¦çœ‹ğŸ‘‰[SASSç”¨æ³•æŒ‡å—](https://microzz.com/2017/03/18/sass/))* **flex**ï¼šflexå¼¹æ€§å¸ƒå±€ï¼Œ**ç®€å•**é€‚é…æ‰‹æœºã€PCç«¯ã€‚* **CSS3**ï¼šCSS3è¿‡æ¸¡åŠ¨ç”»åŠæ ·å¼ã€‚## åˆ†æ### Socket.ioé€šè¿‡Express/Koaåœ¨æœåŠ¡ç«¯å¯ä»¥è¿™æ ·åš:```javascript// Server (app.js)var app = require('express')();var server = require('http').Server(app);var io = require('socket.io')(server);server.listen(80);app.get('/', function (req, res) {  res.sendfile(__dirname + '/index.html');});io.on('connection', function (socket) {  socket.emit('news', { hello: 'world' });  socket.on('my other event', function (data) {    console.log(data);  });});```å®¢æˆ·ç«¯ä»£ç ```javascript// Client (index.html)<script src="/socket.io/socket.io.js"></script><script>  var socket = io.connect('http://localhost');  socket.on('news', function (data) {    console.log(data);    socket.emit('my other event', { my: 'data' });  });</script>```ä¸ç®¡æ˜¯æœåŠ¡å™¨è¿˜æ˜¯å®¢æˆ·ç«¯éƒ½æœ‰ `emit` å’Œ `on` è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œå¯ä»¥è¯´ socket.io çš„æ ¸å¿ƒå°±æ˜¯è¿™ä¸¤ä¸ªå‡½æ•°äº†ï¼Œé€šè¿‡ `emit` å’Œ `on` å¯ä»¥è½»æ¾åœ°å®ç°æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯ä¹‹é—´çš„åŒå‘é€šä¿¡ã€‚`emit` ï¼šç”¨æ¥å‘å°„ä¸€ä¸ªäº‹ä»¶æˆ–è€…è¯´è§¦å‘ä¸€ä¸ªäº‹ä»¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºäº‹ä»¶åï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºè¦å‘é€çš„æ•°æ®ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºå›è°ƒå‡½æ•°ï¼ˆä¸€èˆ¬çœç•¥ï¼Œå¦‚éœ€å¯¹æ–¹æ¥å—åˆ°ä¿¡æ¯åç«‹å³å¾—åˆ°ç¡®è®¤æ—¶ï¼Œåˆ™éœ€è¦ç”¨åˆ°å›è°ƒå‡½æ•°ï¼‰ã€‚`on` ï¼šç”¨æ¥ç›‘å¬ä¸€ä¸ª emit å‘å°„çš„äº‹ä»¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè¦ç›‘å¬çš„äº‹ä»¶åï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºä¸€ä¸ªåŒ¿åå‡½æ•°ç”¨æ¥æ¥æ”¶å¯¹æ–¹å‘æ¥çš„æ•°æ®ï¼Œè¯¥åŒ¿åå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ¥æ”¶çš„æ•°æ®ï¼Œè‹¥æœ‰ç¬¬äºŒä¸ªå‚æ•°ï¼Œåˆ™ä¸ºè¦è¿”å›çš„å‡½æ•°ã€‚socket.io æä¾›äº†ä¸‰ç§é»˜è®¤çš„äº‹ä»¶ï¼ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½æœ‰ï¼‰ï¼š`connect` ã€`message` ã€`disconnect` ã€‚å½“ä¸å¯¹æ–¹å»ºç«‹è¿æ¥åè‡ªåŠ¨è§¦å‘ `connect` äº‹ä»¶ï¼Œå½“æ”¶åˆ°å¯¹æ–¹å‘æ¥çš„æ•°æ®åè§¦å‘ `message` äº‹ä»¶ï¼ˆé€šå¸¸ä¸º `socket.send()` è§¦å‘ï¼‰ï¼Œå½“å¯¹æ–¹å…³é—­è¿æ¥åè§¦å‘ `disconnect` äº‹ä»¶ã€‚æ­¤å¤–ï¼Œsocket.io è¿˜æ”¯æŒè‡ªå®šä¹‰äº‹ä»¶ï¼Œæ¯•ç«Ÿä»¥ä¸Šä¸‰ç§äº‹ä»¶åº”ç”¨èŒƒå›´æœ‰é™ï¼Œæ­£æ˜¯é€šè¿‡è¿™äº›è‡ªå®šä¹‰çš„äº‹ä»¶æ‰å®ç°äº†ä¸°å¯Œå¤šå½©çš„é€šä¿¡ã€‚æœ€åï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æœåŠ¡å™¨ç«¯åŒºåˆ†ä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼š`socket.emit()` ï¼šå‘å»ºç«‹è¯¥è¿æ¥çš„å®¢æˆ·ç«¯å¹¿æ’­`socket.broadcast.emit()` ï¼šå‘é™¤å»å»ºç«‹è¯¥è¿æ¥çš„å®¢æˆ·ç«¯çš„æ‰€æœ‰å®¢æˆ·ç«¯å¹¿æ’­`io.sockets.emit()` ï¼šå‘æ‰€æœ‰å®¢æˆ·ç«¯å¹¿æ’­ï¼Œç­‰åŒäºä¸Šé¢ä¸¤ä¸ªçš„å’Œ## Vue.jsåœ¨Vueçš„æ–¹é¢å°±æ¯”è¾ƒå¸¸è§„äº†ï¼ŒVueå…¨å®¶æ¡¶ï¼šVue2.0+Vuex+axios+vue-router,æˆ‘GitHubçš„æœ‰å‡ ä¸ªå¼€æºé¡¹ç›®å¯ä»¥å‚è€ƒğŸ‘‰https://github.com/microzz## æ€»ç»“1. ç»„ä»¶çŠ¶æ€å¤šäº†ç”¨Vuexç®¡ç†å¾ˆæ–¹ä¾¿ï¼Œå¼•ç”¨ Redux çš„ä½œè€… Dan Abramov çš„è¯è¯´å°±æ˜¯ï¼š> Flux æ¶æ„å°±åƒçœ¼é•œï¼šæ‚¨è‡ªä¼šçŸ¥é“ä»€ä¹ˆæ—¶å€™éœ€è¦å®ƒã€‚2. äº‹å…ˆä¸€å®šè¦å…ˆæƒ³å¥½æ•´ä¸ªé¡µé¢ç»„æˆï¼Œæ€æ ·å»åˆ†ç»„ä»¶å¼€å‘ï¼Œè¿™æ ·åœ¨å¼€å‘é˜¶æ®µä¼šäº‹åŠåŠŸå€ã€‚3. Moment.jsåœ¨Vueä¸­ç”¨ES6çš„æ–¹å¼å¼•å…¥ä¼šæœ‰é—®é¢˜ï¼Œå¯ä»¥å°è¯•åœ¨main.jså°è¯•è¿™æ ·`import moment from 'moment'` `Vue.prototype.moment = moment;`ç»™Vueçš„åŸå‹ä¸Šæ·»åŠ momentï¼Œè¿™æ ·å°±å¯ä»¥åœ¨Vueçš„å®ä¾‹ä¸­éšæ„ä½¿ç”¨å®ƒäº†ã€‚4. getæ–¹å¼é€šè¿‡URLä¼ å‚æœ€å¥½ä½¿ç”¨`encodeURI`å¯¹å‚æ•°è¿›è¡Œç¼–ç 5. ä¸€å®šè¦å¤„ç†å¥½é‚£äº›å¼‚æ­¥æ“ä½œï¼Œå¦åˆ™ä¼šå¸¦æ¥å„ç§é—®é¢˜ã€‚å¼€å‘é˜¶æ®µä½¿ç”¨çš„æ˜¯`Promise`ï¼Œä¸Šçº¿æ—¶å€™ä½¿ç”¨äº†ES7çš„`Async`+`Promise`çš„ç»„åˆï¼Œè®©å¼‚æ­¥æ“ä½œæ›´åŠ åˆç†ã€‚## Aboutå…³äºæˆ‘ï¼šğŸ‘‰https://microzz.com/about/
GitHubï¼šğŸ‘‰ https://github.com/microzz
E-mail: ğŸ‘‰ [zhaohui@microzz.com](mailto:zhaohui@microzz.com)

